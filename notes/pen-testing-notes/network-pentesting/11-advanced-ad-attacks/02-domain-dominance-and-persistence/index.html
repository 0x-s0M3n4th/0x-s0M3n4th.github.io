<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Domain Dominance and Persistence | 0x-s0M3n4th's Blog</title><meta name=keywords content="Persistence,Active Directory,Domain Dominance"><meta name=description content="Achieving long-term persistence and complete domination of an AD domain."><meta name=author content="0x-s0M3n4th"><link rel=canonical href=https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/11-advanced-ad-attacks/02-domain-dominance-and-persistence/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://0x-s0M3n4th.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://0x-s0M3n4th.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://0x-s0M3n4th.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://0x-s0M3n4th.github.io/apple-touch-icon.png><link rel=mask-icon href=https://0x-s0M3n4th.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/11-advanced-ad-attacks/02-domain-dominance-and-persistence/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/11-advanced-ad-attacks/02-domain-dominance-and-persistence/"><meta property="og:site_name" content="0x-s0M3n4th's Blog"><meta property="og:title" content="Domain Dominance and Persistence"><meta property="og:description" content="Achieving long-term persistence and complete domination of an AD domain."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2025-11-24T13:25:00+05:30"><meta property="article:modified_time" content="2025-11-24T13:25:00+05:30"><meta property="article:tag" content="Persistence"><meta property="article:tag" content="Active Directory"><meta property="article:tag" content="Domain Dominance"><meta property="og:image" content="https://0x-s0M3n4th.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0x-s0M3n4th.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Domain Dominance and Persistence"><meta name=twitter:description content="Achieving long-term persistence and complete domination of an AD domain."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://0x-s0M3n4th.github.io/notes/"},{"@type":"ListItem","position":2,"name":"Network Penetration Testing","item":"https://0x-s0M3n4th.github.io/notes/pen-testing-notes/"},{"@type":"ListItem","position":4,"name":"Advanced AD Attacks","item":"https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/11-advanced-ad-attacks/"},{"@type":"ListItem","position":5,"name":"Domain Dominance and Persistence","item":"https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/11-advanced-ad-attacks/02-domain-dominance-and-persistence/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Domain Dominance and Persistence","name":"Domain Dominance and Persistence","description":"Achieving long-term persistence and complete domination of an AD domain.","keywords":["Persistence","Active Directory","Domain Dominance"],"articleBody":"ON THIS SECTION WE WILL LEARN ABOUT 3 TECHNIQUES 1. GOLDEN TICKET , 2. SILVER TICKET AND 3. SKELETON KEY\nGOLDEN TICKET: A golden ticket is a special token that is created by penetration testers using the Security Identifier (SID) of the domain, the domain name, and the NTLMv1 hash of the Kerberos TGT. The golden ticket allows a penetration tester to gain access to any device within the domain by performing PTT(Pass The Ticket). This is possible because the golden ticket is encrypted using the hash of the Kerberos TGT account, which is the built-in krbtgt account on Active Directory. However, the golden ticket is not digitally signed by the krbtgt account hash but is encrypted only. This golden ticket allows anyone to impersonate any user with the privileges associated with the impersonated user on systems within the domain. To make this type of attack even more awesome, imagine that changing the password for the krbtgt account has zero effect on mitigating this attack on Active Directory.\nPRACTICAL DEMO: Fire up windows server 2022 and login as either Domain admin/SQLService Make sure mimikatz is installed beforehand. Open powershell with admin privileges, and launch mimikatz. Use Mimikatz to extract the domain SID and the Kerberos TGT account NTLM hash (krbtgt) using the following command: lsadump::lsa /inject /name:krbtgt Next, use Mimikatz to create a golden ticket by providing the domain SID and krbtgt NTLMv1 hash using the following command: kerberos::golden /user:NotAdmin /domain:MARVEL.local /sid:S-1-5-21-2562431693-949040921-1798036828 /krbtgt:2b7d48bc87107f73c48ea100ca97e7e1 /id:500 /ticket:golden_ticket The username specified in the preceding command does not necessarily need to be a valid user on the domain. Furthermore, using the ID of 500 allows us to specify the administrator user account on the domain. The /ticket command enables us to specify the name of the ticket when it’s created. The golden ticket is stored offline within the Mimikatz directory. This golden ticket will allow a penetration test to access any system on the domain using the current session.\nCreating a super golden ticket for maximum validity period: kerberos::golden /user:NotAdmin /domain:MARVEL.local /sid:S-1-5-21-2562431693-949040921-1798036828 /krbtgt:2b7d48bc87107f73c48ea100ca97e7e1 /id:500 /endin:2147483647 /ticket:super_golden_ticket /endin command enables us to specify the maximum validity of the ticket in minutes.\npass the ticket with mimikatz: kerberos::pttt golden_ticket To open a Command Prompt with the golden ticket session, use the following Mimikatz command: misc::cmd On the cmd try these 2 command: As shown in the preceding screenshot, when the whoami command is executed, the output shows the sqladmin account is currently logged on to the system but the klist command reveals this Command Prompt session is using the NotAdmin user with the golden ticket. Therefore, you can access any device on the network using the golden ticket on this Command Prompt session. Note As previously mentioned in this chapter, changing the krbtgt account password does not invalidate the tickets created by the krbtgt account; however, checking the password twice will invalidate the tickets.\nLearn more about mimikatz\nSilver ticket: Open the domain controller and login as either service account/DOMAIN ADMIN Then load mimikatz on powershell(Open as admin). Next, retrieve the SID of the domain and the NTLM hashes of a service account with a registered SPN or computer account: lsadump::lsa /patch HASH OF THE DC{HYDRA-DC} Important You can also use the lsadump::lsa /inject /name:sqlservice command to retrieve the NTLM hash of a specific account with Mimikatz.\n4. Next, let’s use Mimikatz to create a silver ticket with a fake username, the domain name, the domain SID, the NTLM (RC4) hash of the Domain Controller (DC1), and the target as the domain controller. The service to impersonate will be the HOST:\nkerberos::golden /user:SilverTicket /domain:MARVEL.local /sid:S-1-5-21-2562431693-949040921-1798036828 /rc4:d74d80c4ca134b7558c663b13566a112 /id:1234 /target:HYDRA-DC.MARVEL.local /service:HOST /ticket:silver_ticket 5. Now use the following command to perform PTT as well as get a cmd session: SKELETON KEY: Use the following commands to enable the Mimikatz drivers on the disk of the domain controller and create the skeleton key: mimikatz # privilege::debug mimikatz # !+ mimikatz # !processprotect /process:lsass.exe /remove mimikatz # misc::skeleton mimikatz # !- 2. Then open a command prompt using that skeleton key Important When using the skeleton key, you can access any device on the domain using a valid username and the password as Mimikatz. However, keep in mind any host you’re attempting to access with the skeleton key needs to authenticate to the domain controller on the network. If the domain controller reboots, the skeleton key is lost. However, the skeleton key being lost if the domain controller reboots is an important operational detail. Since Mimikatz manipulates authentication processes that are resident in memory, they are not persistent through reboots unless specific measures are taken to ensure persistence.\nOn the new Cmd use the command powershell to spawn a powershell session. Access the domain controller using the following command: Enter-PSSession -ComputerName HYDRA-DC -credential MARVEL\\Administrator Provide the password of the domain admin: Use the following commands to verify: Further reading: • Understanding Kerberos – https://www.techtarget.com/searchsecurity/definition/ Kerberos • OS Credential Dumping: NTDS – https://attack.mitre.org/techniques/T1003/003/ • OS Credential Dumping: LSA Secrets – https://attack.mitre.org/techniques/T1003/004/ • LLMNR/NBT-NS Poisoning and SMB Relay – https://attack.mitre.org/techniques/ T1557/001/ • Active Directory Security – https://adsecurity.org/\n","wordCount":"844","inLanguage":"en","image":"https://0x-s0M3n4th.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-11-24T13:25:00+05:30","dateModified":"2025-11-24T13:25:00+05:30","author":{"@type":"Person","name":"0x-s0M3n4th"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/11-advanced-ad-attacks/02-domain-dominance-and-persistence/"},"publisher":{"@type":"Organization","name":"0x-s0M3n4th's Blog","logo":{"@type":"ImageObject","url":"https://0x-s0M3n4th.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://0x-s0M3n4th.github.io/ accesskey=h title="0x-s0M3n4th's Blog (Alt + H)"><img src=https://0x-s0M3n4th.github.io/apple-touch-icon.png alt aria-label=logo height=35>0x-s0M3n4th's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://0x-s0M3n4th.github.io/archive/ title=Archives><span>Archives</span></a></li><li><a href=https://0x-s0M3n4th.github.io/table-of-contents/ title="Table of contents"><span>Table of contents</span></a></li><li><a href=https://0x-s0M3n4th.github.io/blogs/ title=Blogs><span>Blogs</span></a></li><li><a href=https://0x-s0M3n4th.github.io/notes/ title=Notes><span>Notes</span></a></li><li><a href=https://0x-s0M3n4th.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://0x-s0M3n4th.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://0x-s0M3n4th.github.io/resume.pdf title=Resume><span>Resume</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://0x-s0M3n4th.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://0x-s0M3n4th.github.io/notes/>Notes</a>&nbsp;»&nbsp;<a href=https://0x-s0M3n4th.github.io/notes/pen-testing-notes/>Network Penetration Testing</a>&nbsp;»&nbsp;<a href=https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/11-advanced-ad-attacks/>Advanced AD Attacks</a></div><h1 class="post-title entry-hint-parent">Domain Dominance and Persistence</h1><div class=post-description>Achieving long-term persistence and complete domination of an AD domain.</div><div class=post-meta><span title='2025-11-24 13:25:00 +0530 IST'>November 24, 2025</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>844 words</span>&nbsp;·&nbsp;<span>0x-s0M3n4th</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#golden-ticket>GOLDEN TICKET:</a><ul><li><a href=#practical-demo>PRACTICAL DEMO:</a></li></ul></li><li><a href=#silver-ticket>Silver ticket:</a></li><li><a href=#skeleton-key>SKELETON KEY:</a></li><li><a href=#further-reading>Further reading:</a></li></ul></nav></div></details></div><div class=post-content><p><em>ON THIS SECTION WE WILL LEARN ABOUT 3 TECHNIQUES 1. GOLDEN TICKET , 2. SILVER TICKET AND 3. SKELETON KEY</em></p><h2 id=golden-ticket>GOLDEN TICKET:<a hidden class=anchor aria-hidden=true href=#golden-ticket>#</a></h2><p>A <code>golden ticket</code> is a special token that is created by penetration testers using the <code>Security Identifier (SID)</code> of the domain, the domain name, and the NTLMv1 hash of the Kerberos TGT. The golden ticket allows a penetration tester to gain access to any device within the domain by performing <code>PTT(Pass The Ticket)</code>.
This is possible because the golden ticket is encrypted using the hash of the Kerberos TGT account, which is the built-in krbtgt account on Active Directory. However, the golden ticket is not digitally signed by the krbtgt account hash but is encrypted only. This golden ticket allows anyone to impersonate any user with the privileges associated with the impersonated user on systems within the domain. To make this type of attack even more awesome, imagine that changing the password for the <code>krbtgt</code> account has zero effect on mitigating this attack on Active Directory.</p><h3 id=practical-demo>PRACTICAL DEMO:<a hidden class=anchor aria-hidden=true href=#practical-demo>#</a></h3><ol><li>Fire up <code>windows server 2022</code> and login as either <code>Domain admin/SQLService</code></li><li>Make sure <code>mimikatz</code> is installed beforehand.</li><li>Open <code>powershell</code> with admin privileges, and launch <code>mimikatz</code>.
<img alt=dd_1 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_1.png></li><li>Use <code>Mimikatz</code> to extract the <code>domain SID</code> and <code>the Kerberos TGT account NTLM hash (krbtgt)</code> using the following command:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>lsadump</span><span class=p>::</span><span class=n>lsa</span> <span class=p>/</span><span class=n>inject</span> <span class=p>/</span><span class=n>name</span><span class=err>:</span><span class=n>krbtgt</span>
</span></span></code></pre></div><p><img alt=dd_2 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_2.png></p><ol><li>Next, use <code>Mimikatz</code> to create a <code>golden ticket</code> by providing the <code>domain SID and krbtgt NTLMv1 hash</code> using the following command:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kerberos</span><span class=p>::</span><span class=n>golden</span> <span class=p>/</span><span class=n>user</span><span class=err>:</span><span class=n>NotAdmin</span> <span class=p>/</span><span class=n>domain</span><span class=err>:</span><span class=n>MARVEL</span><span class=p>.</span><span class=py>local</span> <span class=p>/</span><span class=n>sid</span><span class=err>:</span><span class=n>S</span><span class=p>-</span><span class=mf>1</span><span class=p>-</span><span class=mf>5</span><span class=p>-</span><span class=mf>21</span><span class=p>-</span><span class=mf>2562431693</span><span class=p>-</span><span class=mf>949040921</span><span class=p>-</span><span class=mf>1798036828</span> <span class=p>/</span><span class=n>krbtgt</span><span class=err>:</span><span class=n>2b7d48bc87107f73c48ea100ca97e7e1</span> <span class=p>/</span><span class=n>id</span><span class=err>:</span><span class=mf>500</span> <span class=p>/</span><span class=n>ticket</span><span class=err>:</span><span class=n>golden_ticket</span>
</span></span></code></pre></div><p><strong>The username specified in the preceding command does not necessarily need to be a valid user on the domain. Furthermore, using the <code>ID of 500</code> allows us to specify the administrator user account on the domain. The <code>/ticket</code> command enables us to specify the name of the ticket when it’s created.</strong>
<img alt=dd_3 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_3.png>
<em>The golden ticket is stored offline within the Mimikatz directory. This golden ticket will allow a penetration test to access any system on the domain using the current session.</em></p><ol><li>Creating a <code>super golden ticket</code> for maximum validity period:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kerberos</span><span class=p>::</span><span class=n>golden</span> <span class=p>/</span><span class=n>user</span><span class=err>:</span><span class=n>NotAdmin</span> <span class=p>/</span><span class=n>domain</span><span class=err>:</span><span class=n>MARVEL</span><span class=p>.</span><span class=py>local</span> <span class=p>/</span><span class=n>sid</span><span class=err>:</span><span class=n>S</span><span class=p>-</span><span class=mf>1</span><span class=p>-</span><span class=mf>5</span><span class=p>-</span><span class=mf>21</span><span class=p>-</span><span class=mf>2562431693</span><span class=p>-</span><span class=mf>949040921</span><span class=p>-</span><span class=mf>1798036828</span> <span class=p>/</span><span class=n>krbtgt</span><span class=err>:</span><span class=n>2b7d48bc87107f73c48ea100ca97e7e1</span> <span class=p>/</span><span class=n>id</span><span class=err>:</span><span class=mf>500</span> <span class=p>/</span><span class=n>endin</span><span class=err>:</span><span class=mf>2147483647</span> <span class=p>/</span><span class=n>ticket</span><span class=err>:</span><span class=n>super_golden_ticket</span>
</span></span></code></pre></div><p><img alt=dd_4 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_4.png>
<strong><code>/endin</code> command enables us to specify the maximum validity of the ticket in minutes.</strong></p><ol><li><code>pass the ticket</code> with mimikatz:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kerberos</span><span class=p>::</span><span class=n>pttt</span> <span class=n>golden_ticket</span>
</span></span></code></pre></div><p><img alt=dd_5 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_5.png></p><ol><li>To open a Command Prompt with the golden ticket session, use the following Mimikatz command:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>misc</span><span class=p>::</span><span class=n>cmd</span>
</span></span></code></pre></div><p><img alt=dd_6 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_6.png></p><ol><li>On the cmd try these 2 command:
<img alt=dd_7 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_7.png>
<em>As shown in the preceding screenshot, when the <code>whoami</code> command is executed, the output shows the <code>sqladmin</code> account is currently logged on to the system but the <code>klist</code> command reveals this Command Prompt session is using the <code>NotAdmin</code> user with the golden ticket. Therefore, you can access any device on the network using the golden ticket on this Command Prompt session.</em></li></ol><link rel=stylesheet href=/css/vendors/admonitions.4fd9a0b8ec8899f2ca952048d255a569f433f77dfb3f52f5bc87e7d65cdce449.css integrity="sha256-T9mguOyImfLKlSBI0lWlafQz9337P1L1vIfn1lzc5Ek=" crossorigin=anonymous><div class="admonition note"><div class=admonition-header><svg viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7.0 64 0H224v128c0 17.7 14.3 32 32 32h128v125.7l-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3.0-64-28.7-64-64V64zm384 64H256V0L384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9.0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6.0zM311.9 417 441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
<span>Note</span></div><div class=admonition-content><p>As previously mentioned in this chapter, changing the krbtgt account password does not invalidate the tickets created by the krbtgt account; however, checking the password twice will invalidate the tickets.</p></div></div><p>Learn more about <a href=https://github.com/gentilkiwi/mimikatz>mimikatz</a></p><hr><h2 id=silver-ticket>Silver ticket:<a hidden class=anchor aria-hidden=true href=#silver-ticket>#</a></h2><ol><li>Open the <code>domain controller</code> and login as either <code>service account/DOMAIN ADMIN</code></li><li>Then load <code>mimikatz</code> on powershell(Open as admin).</li><li>Next, retrieve the <code>SID of the domain</code> and <code>the NTLM hashes</code> of a service account with a registered SPN or computer account:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>lsadump</span><span class=p>::</span><span class=n>lsa</span> <span class=p>/</span><span class=n>patch</span>
</span></span></code></pre></div><p><img alt=dd_8 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_8.png>
<em>HASH OF THE DC{HYDRA-DC}</em>
<img alt=dd_9 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_9.png></p><div class="admonition important"><div class=admonition-header><svg viewBox="0 0 512 512"><path d="M256 512A256 256 0 10256 0a256 256 0 100 512zm0-384c13.3.0 24 10.7 24 24v112c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1164 0 32 32 0 11-64 0z"/></svg>
<span>Important</span></div><div class=admonition-content><p>You can also use the <code>lsadump::lsa /inject /name:sqlservice</code> command to retrieve the NTLM hash of a specific account with <code>Mimikatz</code>.</p></div></div><p><img alt=dd_10 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_10.png>
4. Next, let’s use Mimikatz to create a <code>silver ticket</code> with a <code>fake username, the domain name, the domain SID, the NTLM (RC4) hash</code> of the Domain Controller (DC1), and the target as the domain controller. The service to impersonate will be the <code>HOST</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kerberos</span><span class=p>::</span><span class=n>golden</span> <span class=p>/</span><span class=n>user</span><span class=err>:</span><span class=n>SilverTicket</span> <span class=p>/</span><span class=n>domain</span><span class=err>:</span><span class=n>MARVEL</span><span class=p>.</span><span class=py>local</span> <span class=p>/</span><span class=n>sid</span><span class=err>:</span><span class=n>S</span><span class=p>-</span><span class=mf>1</span><span class=p>-</span><span class=mf>5</span><span class=p>-</span><span class=mf>21</span><span class=p>-</span><span class=mf>2562431693</span><span class=p>-</span><span class=mf>949040921</span><span class=p>-</span><span class=mf>1798036828</span> <span class=p>/</span><span class=n>rc4</span><span class=err>:</span><span class=n>d74d80c4ca134b7558c663b13566a112</span> <span class=p>/</span><span class=n>id</span><span class=err>:</span><span class=mf>1234</span> <span class=p>/</span><span class=n>target</span><span class=err>:</span><span class=nb>HYDRA-DC</span><span class=p>.</span><span class=py>MARVEL</span><span class=p>.</span><span class=py>local</span> <span class=p>/</span><span class=n>service</span><span class=err>:</span><span class=n>HOST</span> <span class=p>/</span><span class=n>ticket</span><span class=err>:</span><span class=n>silver_ticket</span>
</span></span></code></pre></div><p><img alt=dd_11 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_11.png>
5. Now use the following command to perform <code>PTT</code> as well as get a <code>cmd</code> session:
<img alt=dd_12 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_12.png></p><p><img alt=dd_13 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_13.png></p><hr><h2 id=skeleton-key>SKELETON KEY:<a hidden class=anchor aria-hidden=true href=#skeleton-key>#</a></h2><ol><li>Use the following commands to enable the <code>Mimikatz drivers</code> on the disk of the domain controller and create the skeleton key:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>mimikatz</span> <span class=c># privilege::debug</span>
</span></span><span class=line><span class=cl><span class=n>mimikatz</span> <span class=c># !+</span>
</span></span><span class=line><span class=cl><span class=n>mimikatz</span> <span class=c># !processprotect /process:lsass.exe /remove</span>
</span></span><span class=line><span class=cl><span class=n>mimikatz</span> <span class=c># misc::skeleton</span>
</span></span><span class=line><span class=cl><span class=n>mimikatz</span> <span class=c># !-</span>
</span></span></code></pre></div><p><img alt=dd_14 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_14.png>
2. Then open a command prompt using that <code>skeleton key</code>
<img alt=dd_15 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_15.png></p><div class="admonition important"><div class=admonition-header><svg viewBox="0 0 512 512"><path d="M256 512A256 256 0 10256 0a256 256 0 100 512zm0-384c13.3.0 24 10.7 24 24v112c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1164 0 32 32 0 11-64 0z"/></svg>
<span>Important</span></div><div class=admonition-content><p>When using the skeleton key, you can access any device on the domain using a valid username and the password as Mimikatz. However, keep in mind any host you’re attempting to access with the skeleton key needs to authenticate to the domain controller on the network. If the domain controller reboots, the skeleton key is lost. However, the skeleton key being lost if the domain controller reboots is an important operational detail. Since Mimikatz manipulates authentication processes that are resident in memory, they are not persistent through reboots unless specific measures are taken to ensure persistence.</p></div></div><ol start=3><li>On the new <code>Cmd</code> use the command <code>powershell</code> to spawn a powershell session.
<img alt=dd_16 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_16.png></li><li>Access the domain controller using the following command:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl> <span class=nb>Enter-PSSession</span> <span class=n>-ComputerName</span> <span class=nb>HYDRA-DC</span> <span class=n>-credential</span> <span class=n>MARVEL</span><span class=p>\</span><span class=n>Administrator</span>
</span></span></code></pre></div><ol start=5><li>Provide the password of the domain admin:
<img alt=dd_17 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_17.png></li><li>Use the following commands to verify:
<img alt=dd_18 loading=lazy src=/images/Pentesting/NP/AD_adv/03/dd_18.png></li></ol><hr><h2 id=further-reading>Further reading:<a hidden class=anchor aria-hidden=true href=#further-reading>#</a></h2><p>• Understanding Kerberos – <a href=https://www.techtarget.com/searchsecurity/definition/>https://www.techtarget.com/searchsecurity/definition/</a>
Kerberos
• OS Credential Dumping: NTDS – <a href=https://attack.mitre.org/techniques/T1003/003/>https://attack.mitre.org/techniques/T1003/003/</a>
• OS Credential Dumping: LSA Secrets – <a href=https://attack.mitre.org/techniques/T1003/004/>https://attack.mitre.org/techniques/T1003/004/</a>
• LLMNR/NBT-NS Poisoning and SMB Relay – <a href=https://attack.mitre.org/techniques/>https://attack.mitre.org/techniques/</a>
T1557/001/
• Active Directory Security – <a href=https://adsecurity.org/>https://adsecurity.org/</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://0x-s0M3n4th.github.io/tags/persistence/>Persistence</a></li><li><a href=https://0x-s0M3n4th.github.io/tags/active-directory/>Active Directory</a></li><li><a href=https://0x-s0M3n4th.github.io/tags/domain-dominance/>Domain Dominance</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Domain Dominance and Persistence on x" href="https://x.com/intent/tweet/?text=Domain%20Dominance%20and%20Persistence&amp;url=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f11-advanced-ad-attacks%2f02-domain-dominance-and-persistence%2f&amp;hashtags=Persistence%2cActiveDirectory%2cDomainDominance"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Domain Dominance and Persistence on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f11-advanced-ad-attacks%2f02-domain-dominance-and-persistence%2f&amp;title=Domain%20Dominance%20and%20Persistence&amp;summary=Domain%20Dominance%20and%20Persistence&amp;source=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f11-advanced-ad-attacks%2f02-domain-dominance-and-persistence%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Domain Dominance and Persistence on reddit" href="https://reddit.com/submit?url=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f11-advanced-ad-attacks%2f02-domain-dominance-and-persistence%2f&title=Domain%20Dominance%20and%20Persistence"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Domain Dominance and Persistence on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f11-advanced-ad-attacks%2f02-domain-dominance-and-persistence%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Domain Dominance and Persistence on whatsapp" href="https://api.whatsapp.com/send?text=Domain%20Dominance%20and%20Persistence%20-%20https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f11-advanced-ad-attacks%2f02-domain-dominance-and-persistence%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Domain Dominance and Persistence on telegram" href="https://telegram.me/share/url?text=Domain%20Dominance%20and%20Persistence&amp;url=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f11-advanced-ad-attacks%2f02-domain-dominance-and-persistence%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Domain Dominance and Persistence on ycombinator" href="https://news.ycombinator.com/submitlink?t=Domain%20Dominance%20and%20Persistence&u=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f11-advanced-ad-attacks%2f02-domain-dominance-and-persistence%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=0x-s0M3n4th/0x-s0M3n4th.github.io data-repo-id=R_kgDOPV2wYg data-category=General data-category-id=DIC_kwDOPV2wYs4C1aSa data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2026 <a href=https://0x-s0M3n4th.github.io/>0x-s0M3n4th's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>